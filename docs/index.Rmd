---
title: "Project 2"
subtitle: "Principal Component Analysis and Logistic Regression"
author: "Max Johansson"
date: "Spring of 2024"
output: 
  html_document:
    theme: cosmo
---

# 1. Introduction 

In this brief project I analyze the ISLR2 data "OJ", containing customers that bought one of two brands of juice. 

```{r, warning = FALSE, message=FALSE}
# Load the packages 
library(ISLR2) # For the OJ data set 
library(dplyr) # For the select() function and %>%
library(corrplot) # For the corrplot() function 
library(RColorBrewer) # For the brewer.pal() function, color palette
library(gplots) # For the heatmap.2() function 

# Load the data 
df <- ISLR2::OJ

# set seed 
set.seed(123456789)

# If statement that checks the presence of NA's. 
if(any(is.na(df))){
  print("These observations are NA:")
  print(df[is.na(df)])
} else {
  print("There are no NA's")
}

```

# 2. Data Exploration 

## 2.1. Overview and Cleaning 
The data contains 18 variables, and I consider the purchase variable the variable of main interest. This variable is one of two factors in the data, the other being store7. Some variables are numeric, but could more appropriately be turned into factors as well, such as storeID and the dummy variables SpecialCH, SpecialMM and STORE. 
```{r}
# The dimensions of the data 
cat("The dimensions of the data are:", base::dim(df)[1], 
    "rows and", base::dim(df)[2], "columns", "\n")

# The class of each variable
sapply(df, class)
```

I transform them into factors, I have 6 factors and 12 numeric variables. For the numeric variables, I produce a heatmap to get an idea of the correlations. 
```{r, warning =FALSE, message=FALSE}
# A for loop to transform some variables into factors
var_list <- c("StoreID", "SpecialCH", "SpecialMM", "STORE")

for(i in var_list){
  df[[i]] <- as.factor(df[[i]])
}


```

```{r, warning = FALSE, message = FALSE}
# Correlation matrix, the purchase variable
corr_mat <- cor(df[,-c(1, 3, 8, 9, 14, 18)]) 

# Heatmap 
my_palette <- RColorBrewer::brewer.pal(100, "RdPu")

gplots::heatmap.2(corr_mat, 
                  scale = "none",
        col = my_palette,
        trace = "none",
        density.info = "none",
        main = "Correlation Matrix")
```



# 3. Modelling 

In one model, I use the untransformed variables. In another, I use the variables without high correlations and the interaction variables, excluding the highly correlated variables on their own. 
```{r, warning = FALSE, message=FALSE}

# Sampling mechanism
sampling <- sample(c(TRUE, FALSE),
                   nrow(df),
                   replace = TRUE,
                   prob = c(0.75, 0.25))

# Fitting data 75%, validation data 25%
fit <- df[sampling,]

val <- df[!sampling,]

# Logistic model 
logistic_model <- stats::glm(Purchase ~ ., 
                      data = fit,
                      family = binomial)


```

I predict the probabilities of the outcomes, then transform them into predictions. The "MM" brand is treated as the "success" in this case, so if a predicted probability is above 50% then the prediction is "MM". The most common outcome in the fitting data is "CH", so I estimate the accuracy of the mode as a predictor as a benchmark. The logistic model performs better than the mode as a predictor. 
```{r, warning = FALSE, message=FALSE}
# predicted probabilities 
logistic_prob <- stats::predict(object = logistic_model, newdata = val, type ="response")

# transform the probabilities into predictions 
logistic_pred <- ifelse(logistic_prob > 0.5, "MM", "CH")

# The accuracy of the predictions 
cat("The accuracy of the logistic model predictions is:", mean(logistic_pred == val$Purchase), "\n")

# Calculate the mode accuracy 
table(fit$Purchase)

mode_accuracy <- 100*round(mean(val$Purchase == "CH"), 2)

# Print it 
cat("The mode 'CH' as a predictor has a", mode_accuracy, "% accuracy", "\n")

```

# 5. Packages 
ISLR2: https://cran.r-project.org/package=ISLR2
dplyr: https://cran.r-project.org/package=dplyr
corrplot: https://cran.r-project.org/package=corrplot
RColorBrewer: https://cran.r-project.org/package=RColorBrewer
gplots: https://cran.r-project.org/package=gplots
